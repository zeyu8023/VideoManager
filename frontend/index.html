<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VideoHub V7.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', 'Noto Sans SC', sans-serif; background: #f8fafc; color: #334155; }
        
        /* è¡¨æ ¼æ ·å¼ */
        .table-container { width: 100%; overflow-x: auto; padding-bottom: 100px; }
        table { width: 100%; border-collapse: collapse; min-width: 1400px; }
        th { font-size: 12px; font-weight: 700; color: #64748b; padding: 12px 8px; background: #f8fafc; border-bottom: 2px solid #e2e8f0; white-space: nowrap; text-align: left; }
        td { padding: 8px; border-bottom: 1px solid #f1f5f9; font-size: 13px; vertical-align: middle; }
        tr:hover td { background: #f8fafc; }

        /* ç¼–è¾‘æ¡†æ ·å¼ */
        .table-input { width: 100%; padding: 4px 8px; border: 1px solid #cbd5e1; border-radius: 4px; font-size: 13px; outline: none; background: white; transition: all 0.2s; }
        .table-input:focus { border-color: #3b82f6; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1); }
        .editing { background: #eff6ff !important; }

        /* å¤šé€‰ä¸‹æ‹‰æ¡†å®¹å™¨ */
        .multi-select-wrap { position: relative; width: 100%; }
        .multi-dropdown { position: absolute; top: 100%; left: 0; width: 200px; background: white; border: 1px solid #e2e8f0; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); z-index: 50; border-radius: 6px; padding: 4px; display: none; max-height: 200px; overflow-y: auto; }
        .multi-dropdown.show { display: block; }
        .multi-option { padding: 6px 8px; cursor: pointer; font-size: 12px; display: flex; align-items: center; gap: 6px; border-radius: 4px; }
        .multi-option:hover { background: #f1f5f9; }
        .multi-option.selected { background: #eff6ff; color: #2563eb; font-weight: bold; }

        /* æ ‡ç­¾æ ·å¼ */
        .pill { padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500; border: 1px solid transparent; display: inline-block; margin-right: 3px; margin-bottom: 2px; }
        
        /* å›¾ç‰‡åŒº */
        .img-zone { width: 44px; height: 44px; border-radius: 6px; border: 1px solid #e2e8f0; background: #fff; overflow: hidden; cursor: pointer; position: relative; }
        .img-zone:hover::after { content: '+'; position: absolute; inset: 0; background: rgba(0,0,0,0.5); color: white; display: flex; justify-content: center; align-items: center; font-weight: bold; }

        /* å¼¹çª— */
        .modal { opacity: 0; pointer-events: none; transition: opacity 0.2s; }
        .modal.active { opacity: 1; pointer-events: auto; }
    </style>
</head>
<body class="flex flex-col h-screen overflow-hidden">

    <div class="h-14 bg-white border-b border-slate-200 flex justify-between items-center px-6 shrink-0 z-40">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold">V</div>
            <h1 class="text-lg font-bold text-slate-800">VideoHub V7</h1>
        </div>
        <div class="flex gap-2">
            <button onclick="openSettings()" class="text-xs font-bold text-slate-500 hover:text-blue-600 bg-slate-50 px-3 py-1.5 rounded border border-slate-100">âš™ï¸ é…ç½®</button>
        </div>
    </div>

    <div class="bg-white border-b border-slate-200 px-6 py-3 shrink-0 z-30">
        <div class="flex gap-4">
            <div class="flex-1 bg-slate-50 border border-slate-100 px-4 py-2 rounded-lg flex items-center justify-between">
                <div><div class="text-[10px] font-bold text-slate-400">æ€»èµ„äº§</div><div class="text-xl font-black text-slate-800" id="st-total">-</div></div>
            </div>
            <div class="flex-1 bg-orange-50 border border-orange-100 px-4 py-2 rounded-lg flex items-center justify-between">
                <div><div class="text-[10px] font-bold text-orange-400">å¾…å‘å¸ƒ</div><div class="text-xl font-black text-orange-500" id="st-pending">-</div></div>
            </div>
            <div class="flex-1 bg-emerald-50 border border-emerald-100 px-4 py-2 rounded-lg flex items-center justify-between">
                <div><div class="text-[10px] font-bold text-emerald-400">æœ¬æœˆåŠ³æ¨¡</div><div class="text-xl font-black text-emerald-600" id="st-host">-</div></div>
            </div>
        </div>
    </div>

    <div class="bg-white border-b border-slate-200 px-6 py-3 shrink-0 z-30">
        <div class="flex flex-wrap items-center gap-2">
            <input id="q-key" onkeydown="if(event.key==='Enter') loadData(1)" placeholder="ğŸ” æœç´¢ç¼–å·/æ ‡é¢˜/å¤‡æ³¨" class="table-input w-64">
            
            <select id="q-cat" onchange="loadData(1)" class="table-input w-24"></select>
            <select id="q-host" onchange="loadData(1)" class="table-input w-24"></select>
            <select id="q-plat" onchange="loadData(1)" class="table-input w-24"></select>
            <select id="q-status" onchange="loadData(1)" class="table-input w-24"></select>
            
            <button onclick="resetFilters()" class="px-3 py-1.5 text-xs font-bold text-slate-500 bg-slate-100 rounded hover:bg-slate-200 ml-auto">é‡ç½®</button>
            <button onclick="loadData(1)" class="px-4 py-1.5 text-xs font-bold text-white bg-blue-600 rounded hover:bg-blue-700">æŸ¥è¯¢</button>
            <button onclick="openAddModal()" class="px-4 py-1.5 text-xs font-bold text-white bg-emerald-600 rounded hover:bg-emerald-700">+ æ–°å¢</button>
        </div>
    </div>

    <div class="flex-1 bg-slate-50 overflow-hidden relative">
        <div class="absolute inset-0 overflow-auto">
            <table class="w-full text-left">
                <thead class="sticky top-0 z-20 shadow-sm">
                    <tr>
                        <th class="w-16 text-center">å›¾</th>
                        <th class="w-24">ç¼–å·</th>
                        <th style="width: 280px;">è§†é¢‘æ ‡é¢˜</th> 
                        <th class="w-24">ç±»å‹</th>
                        <th class="w-28">å®Œæˆæ—¶é—´</th>
                        <th class="w-24">è§†ç±»</th>
                        <th style="width: 140px;">ä¸»æ’­ (å¤šé€‰)</th>
                        <th class="w-24 text-center">çŠ¶æ€</th>
                        <th style="width: 140px;">å¹³å° (å¤šé€‰)</th>
                        <th class="w-32">å‘å¸ƒæ—¶é—´</th>
                        <th class="w-40">å¤‡æ³¨</th>
                        <th class="w-24 text-center sticky right-0 bg-slate-100 border-l">æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="table-body" class="divide-y divide-slate-200 bg-white"></tbody>
            </table>
        </div>
    </div>

    <div class="h-10 bg-white border-t border-slate-200 px-6 flex justify-between items-center shrink-0 text-xs text-slate-500 font-medium z-30">
        <span id="page-info">å…± 0 æ¡</span>
        <div class="flex gap-2">
            <button id="btn-prev" onclick="changePage(-1)" class="hover:text-blue-600 disabled:opacity-50">â—€</button>
            <button id="btn-next" onclick="changePage(1)" class="hover:text-blue-600 disabled:opacity-50">â–¶</button>
        </div>
    </div>

    <div id="preview-modal" class="fixed inset-0 z-50 hidden bg-black/90 flex items-center justify-center" onclick="this.classList.add('hidden')">
        <img id="big-img" src="" class="max-h-[90vh] max-w-[90vw] object-contain">
    </div>

    <div id="add-modal" class="modal fixed inset-0 bg-black/50 z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl w-[600px] p-6 shadow-2xl">
            <h3 class="font-bold mb-4">æ–°å¢èµ„äº§</h3>
            <form id="addForm" class="grid grid-cols-2 gap-4">
                <input name="product_id" placeholder="äº§å“ç¼–å· *" required class="table-input">
                <input name="title" placeholder="è§†é¢‘æ ‡é¢˜ *" required class="table-input">
                <input name="host" id="add-host" placeholder="ä¸»æ’­ (å¯å¤šé€‰)" class="table-input" onclick="toggleMulti(this, 'hosts')">
                <select name="status" id="add-status" class="table-input"></select>
                <select name="category" id="add-cat" class="table-input"></select>
                <input name="platform" id="add-plat" placeholder="å¹³å° (å¯å¤šé€‰)" class="table-input" onclick="toggleMulti(this, 'platforms')">
                <div class="col-span-2 pt-4 flex justify-end gap-2">
                    <button type="button" onclick="closeModal('add-modal')" class="text-slate-500 text-sm font-bold">å–æ¶ˆ</button>
                    <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded text-sm font-bold">ä¿å­˜</button>
                </div>
            </form>
            <div id="modal-multi-dropdown" class="multi-dropdown"></div> 
        </div>
    </div>

    <div id="settings-modal" class="modal fixed inset-0 bg-black/50 z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl w-[400px] p-6 shadow-2xl">
            <h3 class="font-bold mb-4">å…¨å±€é…ç½® (é€—å·åˆ†éš”)</h3>
            <textarea id="set-hosts" class="table-input h-20 mb-2" placeholder="ä¸»æ’­..."></textarea>
            <input id="set-plats" class="table-input mb-2" placeholder="å¹³å°...">
            <input id="set-cats" class="table-input mb-4" placeholder="åˆ†ç±»...">
            <button onclick="saveSettings()" class="w-full bg-blue-600 text-white py-2 rounded font-bold">ä¿å­˜</button>
            <button onclick="closeModal('settings-modal')" class="w-full mt-2 text-slate-400 text-sm">å…³é—­</button>
        </div>
    </div>

    <script>
        let currPage = 1, totalPages = 1, globalData = [], globalOptions = {}, editingId = null;

        // åˆå§‹åŒ–
        (async () => {
            await loadOptions();
            await loadData(1);
            updateStats();
            
            // ç‚¹å‡»å¤–éƒ¨å…³é—­å¤šé€‰ä¸‹æ‹‰
            document.addEventListener('click', (e) => {
                if(!e.target.closest('.multi-select-wrap') && !e.target.closest('#add-host') && !e.target.closest('#add-plat')) {
                    document.querySelectorAll('.multi-dropdown').forEach(el => el.classList.remove('show'));
                }
            });
        })();

        // --- æ ¸å¿ƒé€»è¾‘ ---
        async function loadOptions() {
            const res = await fetch('/api/options');
            globalOptions = await res.json();
            
            // å¡«å……ç­›é€‰ä¸‹æ‹‰
            const fill = (id, items) => document.getElementById(id).innerHTML = `<option value="">å…¨éƒ¨</option>` + items.map(i=>`<option value="${i}">${i}</option>`).join('');
            fill('q-host', globalOptions.hosts); fill('q-cat', globalOptions.categories);
            fill('q-plat', globalOptions.platforms); fill('q-status', globalOptions.statuses);
            
            // å¡«å……æ–°å¢ä¸‹æ‹‰
            const fillReq = (id, items) => document.getElementById(id).innerHTML = items.map(i=>`<option value="${i}">${i}</option>`).join('');
            fillReq('add-cat', globalOptions.categories); fillReq('add-status', globalOptions.statuses);
        }

        async function loadData(p) {
            currPage = p || currPage;
            const params = new URLSearchParams({
                page: currPage, size: 100,
                keyword: document.getElementById('q-key').value,
                host: document.getElementById('q-host').value,
                category: document.getElementById('q-cat').value,
                platform: document.getElementById('q-plat').value,
                status: document.getElementById('q-status').value
            });
            const res = await fetch(`/api/videos?${params}`);
            const data = await res.json();
            globalData = data.items;
            totalPages = data.total_pages;
            
            document.getElementById('page-info').innerText = `å…± ${data.total} æ¡ Â· ç¬¬ ${data.page}/${data.total_pages} é¡µ`;
            document.getElementById('btn-prev').disabled = (data.page <= 1);
            document.getElementById('btn-next').disabled = (data.page >= data.total_pages);

            renderTable(data.items);
        }

        // --- æ¸²æŸ“è¡¨æ ¼ ---
        const getColor = (str, type) => {
            if(!str || str==='nan') return {bg:'#f1f5f9', t:'#94a3b8'};
            if(type==='status') return str.includes('å·²') ? {bg:'#dcfce7',t:'#166534'} : {bg:'#fff7ed',t:'#c2410c'};
            const c=[{bg:'#fee2e2',t:'#991b1b'},{bg:'#dbeafe',t:'#1e40af'},{bg:'#fef3c7',t:'#92400e'},{bg:'#f3e8ff',t:'#6b21a8'}];
            let h=0; for(let i=0;i<str.length;i++) h=str.charCodeAt(i)+((h<<5)-h);
            return c[Math.abs(h)%c.length];
        };
        const pill = (s,t) => !s||s==='nan'?'-':s.split(/[,ï¼Œ]/).map(x=>`<span class="pill" style="background:${getColor(x.trim(),t).bg};color:${getColor(x.trim(),t).t}">${x.trim()}</span>`).join('');
        const cln = s => (s && s!=='nan' && s!=='NaT' && s!=='None') ? s : '';

        function renderTable(items) {
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = items.map(v => {
                const img = (v.image_url && v.image_url.length > 5 && v.image_url !== 'nan') ? v.image_url : '/assets/default.png';
                
                // === ç¼–è¾‘æ¨¡å¼ ===
                if (v.id === editingId) {
                    const sel = (k, list) => `<select id="ed-${k}" class="table-input">${list.map(o => `<option ${o===v[k]?'selected':''}>${o}</option>`).join('')}</select>`;
                    
                    // 2. å¤šé€‰äº¤äº’ï¼šä½¿ç”¨ onclick è§¦å‘è‡ªå®šä¹‰å¤šé€‰èœå•
                    const multiInput = (key, type) => `
                        <div class="multi-select-wrap">
                            <input id="ed-${key}" class="table-input cursor-pointer" value="${cln(v[key])}" readonly onclick="toggleMulti(this, '${type}')">
                            <div class="multi-dropdown" id="dd-${key}-${v.id}"></div>
                        </div>`;

                    return `
                    <tr class="editing">
                        <td class="p-1"><div class="w-10 h-10 bg-slate-200 rounded mx-auto"></div></td>
                        <td><input id="ed-pid" class="table-input" value="${cln(v.product_id)}"></td>
                        <td><input id="ed-title" class="table-input font-bold" value="${cln(v.title)}"></td>
                        <td>${sel('cat', globalOptions.categories)}</td>
                        <td><input id="ed-fin" type="date" class="table-input" value="${cln(v.finish_time)}"></td>
                        <td><input id="ed-type" class="table-input" value="${cln(v.video_type)}"></td>
                        
                        <td>${multiInput('host', 'hosts')}</td>
                        
                        <td>${sel('status', globalOptions.statuses)}</td>
                        
                        <td>${multiInput('plat', 'platforms')}</td>
                        
                        <td><input id="ed-pub" type="datetime-local" class="table-input" value="${cln(v.publish_time).replace(' ','T')}"></td>
                        <td><input id="ed-rem" class="table-input" value="${cln(v.remark)}"></td>
                        <td class="text-center">
                            <button onclick="saveRow(${v.id})" class="text-white bg-blue-600 px-2 py-1 rounded text-xs">ä¿å­˜</button>
                            <button onclick="cancelEdit()" class="text-slate-400 text-xs ml-1">å–æ¶ˆ</button>
                        </td>
                    </tr>`;
                }

                // === æ­£å¸¸æ¨¡å¼ ===
                return `
                <tr class="hover:bg-slate-50 group border-b border-slate-100 last:border-0">
                    <td class="p-1 text-center">
                        <div class="img-zone mx-auto" onclick="showBigImg('${img}')" onpaste="handlePaste(event,${v.id})" ondrop="handleDrop(event,${v.id})" ondragover="event.preventDefault()">
                            <img src="${img}" class="w-full h-full object-cover pointer-events-none">
                        </div>
                    </td>
                    <td class="font-mono text-slate-500 text-xs">${cln(v.product_id)}</td>
                    
                    <td class="font-bold text-slate-700 text-sm overflow-hidden text-ellipsis whitespace-nowrap" style="max-width: 280px;" title="${cln(v.title)}">
                        ${cln(v.title)}
                    </td>
                    
                    <td>${pill(cln(v.category))}</td>
                    <td class="text-slate-400 font-mono text-xs">${cln(v.finish_time)}</td>
                    <td>${pill(cln(v.video_type))}</td>
                    <td>${pill(cln(v.host))}</td>
                    <td class="text-center">${pill(cln(v.status), 'status')}</td>
                    <td>${pill(cln(v.platform))}</td>
                    <td class="text-slate-400 font-mono text-xs">${cln(v.publish_time).replace('T',' ')}</td>
                    <td class="text-slate-400 truncate max-w-[100px] text-xs">${cln(v.remark)}</td>
                    <td class="text-center sticky right-0 bg-white group-hover:bg-slate-50 border-l">
                        <button onclick="startEdit(${v.id})" class="text-blue-600 font-bold text-xs mr-2">ç¼–è¾‘</button>
                        <button onclick="delVideo(${v.id})" class="text-red-400 text-xs">åˆ </button>
                    </td>
                </tr>`;
            }).join('');
        }

        // --- 3. å¤šé€‰é€»è¾‘ (æ ¸å¿ƒä¿®å¤) ---
        function toggleMulti(inputEl, type) {
            // å…³é—­å…¶ä»–
            document.querySelectorAll('.multi-dropdown').forEach(el => el.classList.remove('show'));
            
            // æ‰¾åˆ°æˆ–åˆ›å»ºä¸‹æ‹‰å®¹å™¨
            let dd = inputEl.nextElementSibling;
            if(!dd || !dd.classList.contains('multi-dropdown')) {
                // å¦‚æœæ˜¯åœ¨å¼¹çª—é‡Œï¼Œå¯èƒ½æ²¡æœ‰å…„å¼ŸèŠ‚ç‚¹ï¼Œç”¨å…¨å±€çš„
                dd = document.getElementById('modal-multi-dropdown');
                // å®šä½
                const rect = inputEl.getBoundingClientRect();
                dd.style.top = (rect.bottom + window.scrollY) + 'px';
                dd.style.left = (rect.left + window.scrollX) + 'px';
                dd.style.width = rect.width + 'px';
            }
            
            // æ¸²æŸ“é€‰é¡¹
            const options = globalOptions[type] || [];
            const currentVals = inputEl.value.split(/[,ï¼Œ]/).map(s => s.trim()).filter(s => s);
            
            dd.innerHTML = options.map(opt => {
                const isSel = currentVals.includes(opt);
                return `<div class="multi-option ${isSel?'selected':''}" onclick="selectMulti('${inputEl.id}', '${opt}')">
                    <span>${isSel ? 'â˜‘' : 'â˜'}</span> ${opt}
                </div>`;
            }).join('');
            
            dd.classList.add('show');
            event.stopPropagation();
        }

        function selectMulti(inputId, val) {
            const input = document.getElementById(inputId);
            let vals = input.value.split(/[,ï¼Œ]/).map(s => s.trim()).filter(s => s);
            
            if(vals.includes(val)) vals = vals.filter(v => v !== val); // å–æ¶ˆ
            else vals.push(val); // é€‰ä¸­
            
            input.value = vals.join(', ');
            
            // é‡æ–°æ¸²æŸ“ä¸‹æ‹‰ä¿æŒæ‰“å¼€çŠ¶æ€
            // ç®€å•å¤„ç†ï¼šå…³é—­åé‡æ–°ç‚¹å‡»æ¯”è¾ƒè‡ªç„¶ï¼Œæˆ–è€…ä¿æŒæ‰“å¼€
            // è¿™é‡Œä¸ºäº†ç®€å•ï¼Œç‚¹ä¸€ä¸‹é€‰ä¸€ä¸ªï¼Œæƒ³å¤šé€‰å°±å¤šç‚¹å‡ ä¸‹
        }

        // --- ç¼–è¾‘ä¸ä¿å­˜ ---
        function startEdit(id) { editingId = id; renderTable(globalData); }
        function cancelEdit() { editingId = null; renderTable(globalData); }
        
        async function saveRow(id) {
            const fd = new FormData();
            fd.append('id', id);
            
            // 3. ä¿®å¤å‘å¸ƒå¹³å°ä¿å­˜ Bugï¼šæ˜ç¡® ID æ˜ å°„
            // æ³¨æ„ï¼šeditRow é‡Œç”Ÿæˆçš„ ID æ˜¯ ed-platï¼Œè¿™é‡Œå¿…é¡»å– ed-plat
            const getVal = (eid) => {
                const el = document.getElementById(eid);
                return el ? el.value.replace('T', ' ') : '';
            };

            fd.append('product_id', getVal('ed-pid'));
            fd.append('title', getVal('ed-title'));
            fd.append('category', getVal('ed-cat'));
            fd.append('finish_time', getVal('ed-fin'));
            fd.append('video_type', getVal('ed-type'));
            fd.append('host', getVal('ed-host'));     // å¤šé€‰å€¼ç›´æ¥ä¼ å­—ç¬¦ä¸²
            fd.append('status', getVal('ed-status'));
            fd.append('platform', getVal('ed-plat')); // è¿™é‡Œä¿®å¤äº†ï¼ä¹‹å‰å¯èƒ½æ²¡å¯¹åº”ä¸Š
            fd.append('publish_time', getVal('ed-pub'));
            fd.append('remark', getVal('ed-rem'));
            
            await fetch('/api/video/save', {method:'POST', body:fd});
            editingId = null; loadData(); updateStats();
        }

        // --- å…¶ä»–é€»è¾‘ ---
        function showBigImg(src) { document.getElementById('big-img').src=src; document.getElementById('preview-modal').classList.remove('hidden'); }
        async function uploadRowImg(file, id) {
            const fd = new FormData(); fd.append('file', file);
            const res = await fetch('/api/upload', {method:'POST', body:fd});
            const d = await res.json();
            const row = globalData.find(v => v.id === id);
            const sfd = new FormData(); sfd.append('id', id); sfd.append('image_url', d.url); sfd.append('product_id', row.product_id);
            await fetch('/api/video/save', {method:'POST', body:sfd});
            loadData();
        }
        function handleDrop(e,id){e.preventDefault();if(e.dataTransfer.files[0]) uploadRowImg(e.dataTransfer.files[0],id);}
        function handlePaste(e,id){e.stopPropagation();if(e.clipboardData.files[0]) uploadRowImg(e.clipboardData.files[0],id);}

        // å¼¹çª—ä¸é…ç½®
        function openAddModal() { document.getElementById('add-modal').classList.add('active'); }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }
        document.getElementById('addForm').onsubmit = async (e) => {
            e.preventDefault();
            await fetch('/api/video/save', {method:'POST', body:new FormData(e.target)});
            closeModal('add-modal'); loadData(1); updateStats();
        };
        
        function openSettings() { 
            document.getElementById('settings-modal').classList.add('active'); 
            document.getElementById('set-hosts').value = globalOptions.hosts.join(',');
            document.getElementById('set-plats').value = globalOptions.platforms.join(',');
            document.getElementById('set-cats').value = globalOptions.categories.join(',');
        }
        async function saveSettings() {
            const fd = new FormData();
            const save = (k, v) => fetch('/api/settings', {method:'POST', body: new URLSearchParams({key:k, value:v})});
            await save('hosts', document.getElementById('set-hosts').value);
            await save('platforms', document.getElementById('set-plats').value);
            await save('categories', document.getElementById('set-cats').value);
            closeModal('settings-modal'); loadOptions();
        }

        function resetFilters() { document.querySelectorAll('select, input').forEach(e => {if(e.id.startsWith('q-')) e.value=''}); loadData(1); }
        function changePage(d) { if(currPage+d>0 && currPage+d<=totalPages) loadData(currPage+d); }
        async function delVideo(id) { if(confirm('åˆ ?')) { await fetch(`/api/video/${id}`, {method:'DELETE'}); loadData(); updateStats(); } }
        async function updateStats() { try{const r=await fetch('/api/stats');const d=await r.json();document.getElementById('st-total').innerText=d.total;document.getElementById('st-pending').innerText=d.pending;document.getElementById('st-host').innerText=d.host;}catch{} }
    </script>
</body>
</html>